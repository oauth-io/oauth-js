(function(e){"use strict";function u(e){if(e.match(/^.{2,5}:\/\//))return e;if(e[0]==="/")return document.location.protocol+"//"+document.location.host+e;var t=document.location.protocol+"//"+document.location.host+document.location.pathname;if(t[t.length-1]!="/"&&e[0]!="#")return t+"/"+e;return t+e}function a(e,t,n){e=e.replace(/\{\{(.*?)\}\}/g,function(e,n){return t[n]||""});if(n)e=e.replace(/\{(.*?)\}/g,function(e,t){return n[t]||""});return e}function f(t,n,r,i){return function(s,o){var u={};if(typeof s==="string"){if(typeof o==="object")for(var a in o){u[a]=o[a]}u.url=s}else if(typeof s==="object")for(var a in s){u[a]=s[a]}u.type=u.type||i;u.oauthio={provider:t,tokens:n,request:r};return e.OAuth.http(u)}}function l(e){var t;var n;try{t=JSON.parse(e.data)}catch(r){return e.callback(new Error("Error while parsing result"))}if(!t||!t.provider)return;if(e.provider&&t.provider.toLowerCase()!==e.provider.toLowerCase())return;if(t.status==="error"||t.status==="fail"){n=new Error(t.message);n.body=t.data;return e.callback(n)}if(t.status!=="success"||!t.data){n=new Error;n.body=t.data;return e.callback(n)}if(!t.state||s.indexOf(t.state)==-1)return e.callback(new Error("State is not matching"));if(!e.provider)t.data.provider=t.provider;var i=t.data;if(p(e.cache)&&i)h(t.provider,i);var o=i.request;delete i.request;var u;if(i.access_token)u={access_token:i.access_token};else if(i.oauth_token&&i.oauth_token_secret)u={oauth_token:i.oauth_token,oauth_token_secret:i.oauth_token_secret};if(!o)return e.callback(null,i);if(o.required)for(var a in o.required)u[o.required[a]]=i[o.required[a]];var l=function(e){return f(t.provider,u,o,e)};i.get=l("GET");i.post=l("POST");i.put=l("PUT");i.patch=l("PATCH");i.del=l("DELETE");return e.callback(null,i)}function c(t,n){if(p(n)){n=w("oauthio_provider_"+t);if(!n)return false;n=decodeURIComponent(n)}if(typeof n==="string"){try{n=JSON.parse(n)}catch(r){return false}}if(typeof n==="object"){var i={};for(var s in n)if(s!=="request"&&typeof n[s]!=="function")i[s]=n[s];return e.OAuth.create(t,i,n.request)}return false}function h(e,t){b("oauthio_provider_"+e,encodeURIComponent(JSON.stringify(t)),t.expires_in-10||3600)}function p(e){if(typeof e==="undefined")return t.options.cache;return e}function g(r){i.fetchDescription=function(e){if(n[e])return;n[e]=true;r.ajax({url:t.oauthd_base+t.oauthd_api+"/providers/"+e,data:{extend:true},dataType:"json"}).done(function(t){n[e]=t.data;i.execProvidersCb(e,null,t.data)}).always(function(){if(typeof n[e]!=="object"){delete n[e];i.execProvidersCb(e,new Error("Unable to fetch request description"))}})};e.OAuth.http=function(e){function f(){var e=n.oauthio.request||{};if(!e.cors){n.url=encodeURIComponent(n.url);if(n.url[0]!="/")n.url="/"+n.url;n.url=t.oauthd_url+"/request/"+n.oauthio.provider+n.url;n.headers=n.headers||{};n.headers.oauthio="k="+t.key;if(n.oauthio.tokens.oauth_token&&n.oauthio.tokens.oauth_token_secret)n.headers.oauthio+="&oauthv=1";for(var i in n.oauthio.tokens)n.headers.oauthio+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n.oauthio.tokens[i]);delete n.oauthio;return r.ajax(n)}if(n.oauthio.tokens){if(n.oauthio.tokens.access_token)n.oauthio.tokens.token=n.oauthio.tokens.access_token;if(!n.url.match(/^[a-z]{2,16}:\/\//)){if(n.url[0]!=="/")n.url="/"+n.url;n.url=e.url+n.url}n.url=a(n.url,n.oauthio.tokens,e.parameters);if(e.query){var o=[];for(s in e.query)o.push(encodeURIComponent(s)+"="+encodeURIComponent(a(e.query[s],n.oauthio.tokens,e.parameters)));o=o.join("&");if(n.url.indexOf("?")!==-1)n.url+="&"+o;else n.url+="?"+o}if(e.headers){n.headers=n.headers||{};for(s in e.headers)n.headers[s]=a(e.headers[s],n.oauthio.tokens,e.parameters)}delete n.oauthio;return r.ajax(n)}}var n={};var s;for(s in e){n[s]=e[s]}if(!n.oauthio.request||n.oauthio.request===true){var o={wait:!!n.oauthio.request};var u=r.Deferred();i.getDescription(n.oauthio.provider,o,function(e,t){if(e)return u.reject(e);if(n.oauthio.tokens.oauth_token&&n.oauthio.tokens.oauth_token_secret)n.oauthio.request=t.oauth1&&t.oauth1.request;else n.oauthio.request=t.oauth2&&t.oauth2.request;u.resolve()});return u.then(f)}else return f();}}function y(){var e=N((new Date).getTime()+":"+Math.floor(Math.random()*9999999));return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function b(e,t,n){E(e);var r=new Date;r.setTime(r.getTime()+(n||1200)*1e3);var n="; expires="+r.toGMTString();document.cookie=e+"="+t+n+"; path=/"}function w(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)===" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null}function E(e){var t=new Date;t.setTime(t.getTime()-864e5);document.cookie=e+"=; expires="+t.toGMTString()+"; path=/"}function T(e){return D(M(B(e)))}function N(e){return P(M(B(e)))}function C(e,t){return H(M(B(e)),t)}function k(e,t){return D(_(B(e),B(t)))}function L(e,t){return P(_(B(e),B(t)))}function A(e,t,n){return H(_(B(e),B(t)),n)}function O(){return T("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function M(e){return q(R(I(e),e.length*8))}function _(e,t){var n=I(e);if(n.length>16)n=R(n,e.length*8);var r=Array(16),i=Array(16);for(var s=0;s<16;s++){r[s]=n[s]^909522486;i[s]=n[s]^1549556828}var o=R(r.concat(I(t)),512+t.length*8);return q(R(i.concat(o),512+160))}function D(e){try{S}catch(t){S=0}var n=S?"0123456789ABCDEF":"0123456789abcdef";var r="";var i;for(var s=0;s<e.length;s++){i=e.charCodeAt(s);r+=n.charAt(i>>>4&15)+n.charAt(i&15)}return r}function P(e){try{x}catch(t){x=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var r="";var i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++){if(s*8+u*6>e.length*8)r+=x;else r+=n.charAt(o>>>6*(3-u)&63)}}return r}function H(e,t){var n=t.length;var r=Array();var i,s,o,u;var a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++){a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1)}while(a.length>0){u=Array();o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i];s=Math.floor(o/n);o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o;a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function B(e){var t="";var n=-1;var r,i;while(++n<e.length){r=e.charCodeAt(n);i=n+1<e.length?e.charCodeAt(n+1):0;if(55296<=r&&r<=56319&&56320<=i&&i<=57343){r=65536+((r&1023)<<10)+(i&1023);n++}if(r<=127)t+=String.fromCharCode(r);else if(r<=2047)t+=String.fromCharCode(192|r>>>6&31,128|r&63);else if(r<=65535)t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63);else if(r<=2097151)t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63)}return t}function j(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function F(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function I(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function q(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function R(e,t){e[t>>5]|=128<<24-t%32;e[(t+64>>9<<4)+15]=t;var n=Array(80);var r=1732584193;var i=-271733879;var s=-1732584194;var o=271733878;var u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r;var l=i;var c=s;var h=o;var p=u;for(var d=0;d<80;d++){if(d<16)n[d]=e[a+d];else n[d]=X(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=W(W(X(r,5),U(d,i,s,o)),W(W(u,n[d]),z(d)));u=o;o=s;s=X(i,30);i=r;r=v}r=W(r,f);i=W(i,l);s=W(s,c);o=W(o,h);u=W(u,p)}return Array(r,i,s,o,u)}function U(e,t,n,r){if(e<20)return t&n|~t&r;if(e<40)return t^n^r;if(e<60)return t&n|t&r|n&r;return t^n^r}function z(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function W(e,t){var n=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function X(e,t){return e<<t|e>>>32-t}var t={oauthd_url:"https://oauth.io",oauthd_api:"/api",version:"web-0.1.7",options:{}};var n={};var r={};var i={execProvidersCb:function(e,t,n){if(r[e]){var i=r[e];delete r[e];for(var s in i)i[s](t,n)}},getDescription:function(e,t,s){t=t||{};if(typeof n[e]==="object")return s(null,n[e]);if(!n[e])i.fetchDescription(e);if(!t.wait)return s(null,{});r[e]=r[e]||[];r[e].push(s)}};t.oauthd_base=u(t.oauthd_url).match(/^.{2,5}:\/\/[^/]+/)[0];var s=[];var o;(function(){var t=/[\\#&]oauthio=([^&]*)/.exec(document.location.hash);if(t){document.location.hash=document.location.hash.replace(/&?oauthio=[^&]*/,"");o=decodeURIComponent(t[1].replace(/\+/g," "));var n=w("oauthio_state");if(n){s.push(n);E("oauthio_state")}}})();if(!e.OAuth){e.OAuth={initialize:function(e,n){t.key=e;if(n)for(var r in n)t.options[r]=n[r]},setOAuthdURL:function(e){t.oauthd_url=e;t.oauthd_base=u(t.oauthd_url).match(/^.{2,5}:\/\/[^/]+/)[0]},getVersion:function(){return t.version},create:function(e,t,n){if(!t)return c(e,true);if(typeof n!=="object")i.fetchDescription(e);var r=function(r){return f(e,t,n,r)};var s={};for(var o in t)s[o]=t[o];s.get=r("GET");s.post=r("POST");s.put=r("PUT");s.patch=r("PATCH");s.del=r("DELETE");return s},popup:function(e,n,r){function m(e){if(e.origin!==t.oauthd_base)return;try{i.close()}catch(e){}n.data=e.data;return l(n)}var i,o,a;if(!t.key)return r(new Error("OAuth object must be initialized"));if(arguments.length==2){r=n;n={}}if(p(n.cache)){var f=c(e,n.cache);if(f)return r(null,f)}if(!n.state){n.state=y();n.state_type="client"}s.push(n.state);var h=t.oauthd_url+"/auth/"+e+"?k="+t.key;h+="&d="+encodeURIComponent(u("/"));if(n)h+="&opts="+encodeURIComponent(JSON.stringify(n));var d={width:Math.floor(window.outerWidth*.8),height:Math.floor(window.outerHeight*.5)};if(d.height<350)d.height=350;if(d.width<800)d.width=800;d.left=window.screenX+(window.outerWidth-d.width)/2;d.top=window.screenY+(window.outerHeight-d.height)/8;var v="width="+d.width+",height="+d.height;v+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";v+=",left="+d.left+",top="+d.top;n={provider:e,cache:n.cache};n.callback=function(e,t){if(window.removeEventListener)window.removeEventListener("message",m,false);else if(window.detachEvent)window.detachEvent("onmessage",m);else if(document.detachEvent)document.detachEvent("onmessage",m);n.callback=function(){};if(a){clearTimeout(a);a=undefined}return r(e,t)};if(window.attachEvent)window.attachEvent("onmessage",m);else if(document.attachEvent)document.attachEvent("onmessage",m);else if(window.addEventListener)window.addEventListener("message",m,false);if(typeof chrome!="undefined"&&chrome.runtime&&chrome.runtime.onMessageExternal)chrome.runtime.onMessageExternal.addListener(function(e,t,n){e.origin=t.url.match(/^.{2,5}:\/\/[^/]+/)[0];return m(e)});if(!o&&(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)){o=document.createElement("iframe");o.src=t.oauthd_url+"/auth/iframe?d="+encodeURIComponent(u("/"));o.width=0;o.height=0;o.frameBorder=0;o.style.visibility="hidden";document.body.appendChild(o)}a=setTimeout(function(){n.callback(new Error("Authorization timed out"));try{i.close()}catch(e){}},1200*1e3);i=window.open(h,"Authorization",v);if(i)i.focus();else n.callback(new Error("Could not open a popup"))},redirect:function(e,n,r){if(arguments.length==2){r=n;n={}}if(p(n.cache)){var i=c(e,n.cache);if(i){r=u(r)+(r.indexOf("#")===-1?"#":"&")+"oauthio=cache";document.location.href=r;document.location.reload();return}}if(!n.state){n.state=y();n.state_type="client"}b("oauthio_state",n.state);var s=encodeURIComponent(u(r));r=t.oauthd_url+"/auth/"+e+"?k="+t.key;r+="&redirect_uri="+s;if(n)r+="&opts="+encodeURIComponent(JSON.stringify(n));document.location.href=r},callback:function(e,t,n){if(arguments.length==1){n=e;e=undefined;t={}}if(arguments.length==2){n=t;t={}}if(p(t.cache)||o==="cache"){if(o==="cache"&&(typeof e!=="string"||!e))return n(new Error("You must set a provider when using the cache"));var r=c(e,t.cache);if(r)return n(null,r)}if(!o)return;l({data:o,provider:e,cache:t.cache,callback:n})},clearCache:function(e){E("oauthio_provider_"+e)}};if(typeof jQuery=="undefined"){var d=[];var v;if(typeof chrome!="undefined"&&chrome.runtime){v=function(){return function(){throw new Error("Please include jQuery before oauth.js")}}}else{var m=document.createElement("script");m.src="//code.jquery.com/jquery.min.js";m.type="text/javascript";m.onload=function(){g(jQuery);for(var e in d)d[e].fn.apply(null,d[e].args)};document.getElementsByTagName("head")[0].appendChild(m);v=function(e){return function(){var t=[];for(var n in arguments)t[n]=arguments[n];d.push({fn:e,args:t})}}}e.OAuth.http=v(function(){e.OAuth.http.apply(e.OAuth,arguments)});i.fetchDescription=v(function(){i.fetchDescription.apply(i,arguments)})}else g(jQuery)}var S=0;var x=""})(this||window);
